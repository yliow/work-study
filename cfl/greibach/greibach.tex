\section{Greibach Normal Form}

A grammar is in \defterm{Greibach Normal Form} if every production
is of the form
\begin{align*}
 A &\rightarrow b\alpha\\
\end{align*}
where $A$ is a variable, $b$ is a terminal and $\alpha$ is a
string of variables. In the case of Chomsky Normal Form, note that
$\ep$ is not in the language generated by such a language. The
Greibach Normal Form is used in parsing and proofs of various
theorems.

To change a grammar (that does not generate $\ep$) to a Greibach
Normal Form requires a lot more work.
\begin{mylist}
 \item Replace it by a grammar in Chomsky Normal Form (of course
 without changing language). Rename the variables to $A_1, \ldots,
 A_n$.
 \item Replace grammar by one with with ascending variable property
 (AVP), i.e., all productions are of the form
  \[ A_i \rightarrow A_jW \,\,\,\,\, j>i \]
  or
  \[ A_i \rightarrow aW , \,\,\,\, W \in V^*\]
 \item Process $A_n, A_{n - 1}, \ldots, A_1$ (in this order) by a short-circuiting trick
 or by removal of left-recursion (later).
\end{mylist}
We're already done with Step 1.

Step 2 (AVP) is much harder so we'll delay that. For the time
being here's an example for you so that you understand the concept
of AVP. Look at the following grammar:
\begin{align*}
 A_1 &\rightarrow A_3A_1A_1 \,|\, aA_3 \,|\, \mathbf{A_1A_2} \\
 A_2 &\rightarrow A_4A_2A_3 \,|\, bA_2 \,|\, \mathbf{A_1A_1A_2} \,|\,
 \mathbf{A_2A_1} \\
 A_3 &\rightarrow A_4 \,|\, A_4 A_3 \,|\, \mathbf{A_1A_3A_1} \,|\,
 \mathbf{A_2}
 \,|\, \mathbf{A_3A_3} \\
 A_4 &\rightarrow aA_4 \,|\, b \,|\, \mathbf{A_1A_1} \,|\, \mathbf{A_2} \,|\,
 \mathbf{A_3A_2}
 \,|\, \mathbf{A_4A_4} \\
\end{align*}
The derivation with the right-hand-side in bold are those which
violate the AVP. For instance $A_1 \rightarrow A_1A_2$ violates
the AVP. Right?

Suppose we're done with Step 2. This is how you get from Step 2 to
Step 3. I will illustrate this with an example. The idea is very
simple. Before we do the example, here's a lemma:

\begin{lem} If $A \neq B$ and $A \rightarrow \alpha_1 B \alpha_2$,
then $B \rightarrow \beta_1 \,|\, \ldots, \,|\, \beta_n$ are all
the productions of with $B$ on the left-hand-side, then you can
eliminate $A \rightarrow \alpha_1 B \alpha_2$ and replace it with
\[
A \rightarrow \alpha_1 \beta_1 \alpha_2 \,|\,
 \alpha_1 \beta_2 \alpha_2 \,|\, \ldots \,|\,
 \alpha_1 \beta_n \alpha_2 \,|\,
\]
without changing the language generated by the original grammar.
\end{lem}

We're just short circuiting the derivation. For instance if $A
\rightarrow aCBd$ and $B \rightarrow b \,|\, cD$ are all the
productions with $B$ on the left-hand-side, then we can replace $A
\rightarrow aCBd$ with
\[
 A \rightarrow aCbd \,|\, aCcDd
\]

OK, now for the example:

\begin{eg}
Consider the following grammar:
\begin{align*}
 A_1 &\rightarrow A_3 A_1A_1 \,|\, aA_3 \\
 A_2 &\rightarrow A_4A_2A_3 \,|\, bA_2 \\
 A_3 &\rightarrow A_4 \,|\, A_4 A_3 \\
 A_4 &\rightarrow aA_4 \,|\, b
\end{align*}
It satisfies the AVP (right?). Now we need to perform step 3 to
make it into a Greibach Normal Form.

First of all productions of $A_4$ are already in the right form.
In fact the variable with the highest index will \textit{always} be
OK. (Why? Use AVP!)

Next look at $A_3$. The trick is to use the productions of $A_4$.
By the above lemma, we can short circuit productions of $A_3$ and
get replace the old $A_3$ productions as follows: For $A_3
\rightarrow A_4$, we get
\[
 A_3 \rightarrow aA_4 \,|\, b \,|\, a A_4 A_3
\]
and for $A_3\rightarrow A_4A_3$, we get
\[
 A_3 \rightarrow aA_4A_3 \,|\, bA_3
\]
So the old production for $A_3$ is replaced by
\[
 A_3 \rightarrow aA_4 \,|\, b \,|\, a A_4 A_3 \,|\, aA_4A_3 \,|\, bA_3
\]
As you can see, these are in Greibach Normal Form.

The rest of the story is similar: While processing $A_2$, use
productions of $A_3$ (the new ones) and $A_4$. Here are the
results. The old production for $A_2$ should be replaced by
\[
 A_2 \rightarrow aA_4 A_2 A_3 \,|\, b A_2 A_3 \,|\, b A_2
\]
and the old production for $A_1$ is replaced by
\[
 A_1 \rightarrow aA_4 A_1 A_1 \,|\, bA_1 A_1 \,|\, aA_4 A_3 A_1
 A_1 \,|\, bA_3 A_1 A_1 \,|\, a A_3
\]

That's it!
\end{eg}

OK. So where are we? There are 3 steps to be performs. The first
is to change the grammar to Chomsky Normal Form (that itself
involves a few steps. For Step 2, change it to have AVP. Finally
for Step 3, reverse process it by a short circuiting trick. We're
done with Step 1 and Step 3. Now for Step 2 (the AVP).

First there is a simple fact that you should know. Suppose you
look at the production
\[
 A \rightarrow A \alpha \,|\, \beta
\]
The production $A \rightarrow A \alpha$ is called a left
recursion. Just look at this derivation and you'd see why:
\[
 A \implies A \alpha \implies A\alpha\alpha \implies A
 \alpha\alpha\alpha \istar A \alpha^n \implies \beta \alpha^n
\]
You can change this to a right recursion by introducing a new
variable:
\begin{align*}
 A \rightarrow \beta \,|\, \beta A' \\
 A' \rightarrow \alpha A' \,|\, \alpha
\end{align*}
Obviously this also generated the sentential form $\beta\alpha^n$
for $n \geq 0$. More generally, we have the following lemma:

\begin{lem}
If
\begin{align*}
 A &\rightarrow A \alpha_1 \,|\, A \alpha_2 \,|\, \ldots \,|\, A
 \alpha_n \\
 A &\rightarrow \beta_1 \,|\, \beta_2 \,|\, \ldots \,|\, \beta_m
\end{align*}
where the first line gives all the left recursion of $A$, and the
second gives all the other derivation of $A$, then introducing a
new variable $A'$ we can replace the above productions by
\begin{align*}
 A &\rightarrow \beta_1 \,|\, \beta_2 \,|\, \ldots \,|\, \beta_n \\
 A &\rightarrow \beta_1 A' \,|\, \beta_1 A' \,|\, \ldots \,|\, \beta_mA' \\
 A' &\rightarrow \alpha_1 A' \,|\, \alpha_2 A' \,|\, \ldots \,|\, \alpha_n A' \\
 A' &\rightarrow \alpha_1 \,|\, \alpha_2 \,|\, \ldots \,|\, \alpha_n
\end{align*}
without changing the language generate.
\end{lem}

The proof is easy. Here's the main idea of Step 2. We process
$A_1, \ldots, A_n$ (in this order) and while processing $A_i$,
either it's already has the AVP of it looks like $A_i \rightarrow
A_j \alpha$ and $j<i$ or $j=i$. For the case $j<i$, you can
replace the production by another production by short circuiting
(lemma 1 again) with a production of $A_j$. Note that $j<i$ so it
has already been processed and since it has AVP, the productions
of $A_j$ would look like $A_j \rightarrow A_k$ where $k>j$. In
other words you can slowly increase the index value of the
variable.

If $j=i$, this is then a left recursion. So you use the above
lemma. The new variable introduced should be named $A_{-i}$.

Let's do an example so that you see this in action:

\begin{eg}
 Consider the following grammar:
 \begin{align*}
  A_1 &\rightarrow A_2 A_2 \\
  A_2 &\rightarrow A_1 A_3 \,|\, a \\
  A_3 &\rightarrow A_1 A_2 \,|\, A_2 A_1 \,|\, a
 \end{align*}
Note that it is in Chomsky Normal Form. Let's process this so that
it has the AVP.

The production rule for $A_1$ is already has the AVP.

For the second line, the production $A_2 \rightarrow a$ has the
AVP, but the production
 \[
  A_2 \rightarrow A_1 A_3
 \]
 is does not.

By short circuiting the $A_1$ in the production with the
production $A_1 \rightarrow A_2A_2$ (lemma 1), we get
\[
 A_2 \rightarrow A_2 A_2 A_3
\]
(As you can see we are moving the index value up). Now we have a
left recursion. We use lemma 2 to change this into a right
recursion: Introduce variable $A_{-2}$ to get
\begin{align*}
 A_2 &\rightarrow a \,|\, aA_{-2} \\
 A_{-2} &\rightarrow A_2 A_3 \,|\, A_2 A_3 A_{-2}
\end{align*}
At this point, the variables $A_{-2}, A_1, A_2$ have the AVP.

Now consider $A_3$. You should get
\[
 A_3 \rightarrow aA_2A_2 \,|\, aA_{-2}A_2A_2 \,|\, aA_1 \,|\, a
 A_{-2} A_1 \,|\, a
\]
This then creates a grammar with AVP without changing the
language.
\end{eg}

\begin{eg}
Let's complete the above example by applying Step 3 to it to get a
grammar in Greibach Normal Form. So far we have
\begin{align*}
A_{-2} &\rightarrow A_2 A_3 \,|\, A_2 A_3 A_{-2} \\
A_1 &\rightarrow A_2A_2 \\
A_2 &\rightarrow a \,|\, a A_{-2} \\
A_3 &\rightarrow aA_2 A_2 \,|\, a A_{-2} A_2 A_2 \,|\, aA_1 \,|\,
a A_{-2} A_1 \,|\, a \\
\end{align*}
\end{eg}

Remember we have to process with the highest index first. The
productions for both $A_3$ and $A_2$ are already in Greibach
Normal Form. Look at $A_1$:
\[
 A_1 \rightarrow A_2A_2 \\
\]
Using the productions for $A_2$ we short circuit with lemma 1 to
get
\[
 A_1 \rightarrow A A_2 \,|\, a A_{-2} A_2
\]
Now let's look at the production rules for $A_{-2}$:
\[
 A_{-2} \rightarrow A_2 A_3 \,|\, A_2 A_3 A_{-2}
\]
Let's do this one at a time. For $A_{-2} \rightarrow A_2 A_3$, we
use the productions for $A_2$ and lemma 1 to get
\[
 A_{-2} \rightarrow aA_3 \,|\, aA_{-2} A_3
\]
For $A_{-2} \rightarrow A_2 A_3 A_{-2}$, we again use the
production rules for $A_2$ to get
\[
 A_{-2} \rightarrow a A_3 A_{-2} \,|\, a A_{-2} A_3 A_{-2}
\]
Altogether the grammar is now replaced by the following
\begin{align*}
 A_{-2} &\rightarrow a A_3 \,|\, a A_2 A_3 \,|\, a A_3 A_{-2} \,|\,
 a A_{-2} A_3 A_{-2} \\
 A_1 &\rightarrow a A_2 \,|\, a A_{-2} A_2 \\
 A_2 &\rightarrow a \,|\, a A_{-2} \\
 A_3 &\rightarrow aA_2^2 \,|\, a A_{-2} A_2^2 \,|\, a A_1 \,|\, a
 A_{-2} A_1 \,|\, a
\end{align*}
which is clearly in Greibach Normal Form.
